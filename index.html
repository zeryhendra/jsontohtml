<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <main id="main">
        <div>
            <div>
                <div id="contents">
                    <ul>
                        <li>a</li>
                        <li>b</li>
                        <li>c</li>
                    </ul>
                </div>

                <p>hello world</p>
            </div>
        </div>

        <p>hi</p>
    </main>
</body>
<script>
    /* https://stackoverflow.com/questions/12980648/map-html-to-json */
    /* html2json */
    const TextElem = e => ({
      type:
        'TextElem',
      textContent:
        e.textContent
    })

    const Elem = e => ({
      type:
        'Elem',
      tagName:
        e.tagName,
      attributes:
        Array.from(e.attributes, ({name, value}) => [name, value]),
      children:
        Array.from(e.childNodes, fromNode)
    })

    const fromNode = e => {
      switch (e?.nodeType) {
        case 1: return Elem(e)
        case 3: return TextElem(e)
        default: throw Error(`unsupported nodeType: ${e.nodeType}`)
      }
    }

    const html2json = e =>
      JSON.stringify(Elem(e), null, '  ')
</script>

<script>
    /* json to html */
    function jsontohtml(jsonItem) {
        let p;
        if (jsonItem != null) { 
            switch (jsonItem?.type) {
                case 'TextElem': 
                    p = document.createTextNode(jsonItem.textContent);
                    break;
    
                case 'Elem':
                    p = document.createElement(jsonItem.tagName);
    
                    // attributes 
                    if (typeof jsonItem.attributes != 'undefined' && jsonItem.attributes != null && jsonItem.attributes.length != null && jsonItem.attributes.length > 0) {
                        for (let no=0; no < jsonItem.attributes.length; no++) {
                            p.setAttribute(jsonItem.attributes[no][0], jsonItem.attributes[no][1]);
                        }
                    }
    
                    Array.from(jsonItem.children, child => {
                        const childElement = jsontohtml(child);
                        p.appendChild(childElement);
                    });
                    break;
                    
                default: break;
            }
        }
        else {
            p = document.createElement(jsonItem.tagName);
    
            // attributes
            if (typeof jsonItem.attributes != 'undefined' && jsonItem.attributes != null && jsonItem.attributes.length != null && jsonItem.attributes.length > 0) {
                for (let no=0; no < jsonItem.attributes.length; no++) {
                    p.setAttribute(jsonItem.attributes[no][0], jsonItem.attributes[no][1]);
                }
            }
    
            Array.from(jsonItem.children, child => {
                const childElement = jsontohtml(child);
                p.appendChild(childElement);
            });
        }
    
        return p;
    }



    console.log(jsontohtml( JSON.parse( html2json(document.querySelector('main') ) ) ) );
    
    var newhtml = jsontohtml( JSON.parse( html2json(document.querySelector('main') ) ) );
    document.querySelector('body').append( newhtml );
    
</script>
</html>
